value = c.followers;
                    document.getElementById('pageName').value = c.pageName;
                    document.getElementById('pageLink').value = c.pageLink;
                    document.getElementById('phone').value = c.phone;
                    document.getElementById('amountPaid').value = c.amountPaidDZD;
                    document.getElementById('dollarRate').value = c.dollarRate;
                    document.getElementById('serviceExpense').value = c.serviceExpenseUSD;
                    document.getElementById('paidCheck').checked = c.paid;
                    calculate();
                }
            } else {
                document.getElementById('trackingNumber').value = 'NV-' + Math.floor(Math.random()*9000 + 1000);
            }
        })();

        form.onsubmit = (e) => {
            e.preventDefault();
            const clients = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
            
            const sales = parseFloat(document.getElementById('amountPaid').value) || 0;
            const rate = parseFloat(document.getElementById('dollarRate').value) || 0;
            const expense = parseFloat(document.getElementById('serviceExpense').value) || 0;

            const newData = {
                id: editingId || Date.now().toString(),
                date: document.getElementById('dateInput').value,
                trackingNumber: document.getElementById('trackingNumber').value,
                followers: document.getElementById('followers').value,
                pageName: document.getElementById('pageName').value,
                pageLink: document.getElementById('pageLink').value,
                phone: document.getElementById('phone').value,
                amountPaidDZD: sales,
                dollarRate: rate,
                serviceExpenseUSD: expense,
                paid: document.getElementById('paidCheck').checked,
                netProfitDZD: sales - (expense * rate)
            };

            if (editingId) {
                const index = clients.findIndex(x => x.id === editingId);
                if(index !== -1) clients[index] = newData;
                sessionStorage.removeItem('editClientId');
            } else {
                clients.push(newData);
            }

            localStorage.setItem(STORAGE_KEY, JSON.stringify(clients));
            showToast("تم الحفظ بنجاح!");
            setTimeout(() => window.location.href = 'vu.html', 1000);
        };

        function cancelEdit() {
            sessionStorage.removeItem('editClientId');
            window.location.href = 'vu.html';
        }
    </script>
</body>
</html>